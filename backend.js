Backend={};Backend.Observable={addEvent:function(A){this.addEvents([A])},addEvents:function(A){this.listeners=this.listeners||{};A.each(function(B){if(this.listeners[B]==undefined){this.listeners[B]=[]}}.bind(this))},on:function(A,B){this.listeners=this.listeners||{};if(this.listeners[A]==undefined){return }this.listeners[A].push(B)},allOn:function(A){if(Object.isUndefined(A)){return }$H(this.listeners).keys().each(function(B){if(!Object.isUndefined(A[B])){this.on(B,A[B])}})},fire:function(){args=$A(arguments);name=args.shift();this.listeners=this.listeners||{};if(this.listeners[name]!=undefined){this.listeners[name].each(function(A){A.apply(A,args)})}},purge:function(){this.listeners={}},removeEvent:function(A,B){if(this.listeners[A]==undefined){return }this.listeners[A]=this.listeners[A].without(B)},suspend:function(){this.suspendEvents=true},resume:function(){this.suspendEvents=false}};Backend.Configurable={setDefaults:function(A){this.defaults=this.defaults||{};this.defaults=Object.extend(A,this.defaults)},configure:function(A){this.defaults=this.defaults||{};this.config=Object.extend(this.defaults,A)},getConfig:function(){return this.config}};if(!window.Backend){var Backend={}}Backend.Ajax={iframeRequests:{},reqCount:0,getXmlHttpRequest:Ajax.getTransport,getTransport:function(A){A=A||"xhr";if("xhr"==A.toLowerCase()){return Backend.Ajax.getXmlHttpRequest()}else{if("iframe"==A.toLowerCase()){return new Backend.Ajax.IframeRequest()}}},createIframe:function(D){var A=this;var B=document.createElement("DIV");Object.extend(B.style,{position:"absolute",top:0,marginLeft:"-10000px"});if(navigator.userAgent.indexOf("MSIE")>0&&navigator.userAgent.indexOf("Opera")==-1){B.innerHTML='<iframe name="frame_'+D+'" id="frame_'+D+'" src="about:blank" onload="setTimeout(function(){Backend.Ajax.iframeRequests['+D+']._onload()},20);"></iframe>'}else{var C=document.createElement("iframe");C.setAttribute("name","frame_"+D);C.setAttribute("id","frame_"+D);C.addEventListener("load",function(){Backend.Ajax.iframeRequests[D]._onload()},false);B.appendChild(C)}document.getElementsByTagName("body").item(0).appendChild(B);var C=$("frame_"+D);C.observe("load",function(){Backend.Ajax.iframeRequests[D]._onload()});return C}};Ajax.getTransport=Backend.Ajax.getTransport;Backend.Ajax.IframeRequest=Class.create({initialize:function(){this.responseText=null;this.responseXML=null;this.status=null;this.statusText=null;this.readyState=0;Backend.Ajax.reqCount++;this._method=null;this._uri=null;this._bodyData=null;this._req_id=Backend.Ajax.reqCount;this._requestHeaders={};Backend.Ajax.iframeRequests[this._req_id]=this},onreadystatechange:function(){},setState:function(A){this.readyState=A;this.onreadystatechange()},open:function(E,C,B,D,A){this._method=E.toUpperCase();this._uri=C;this.setState(1)},setRequestHeader:function(B,A){this._requestHeaders[B]=A},send:function(A){this._bodyData=A;this._frame=Backend.Ajax.createIframe(this._req_id);if("FORM"==this._method){return this._sendViaForm()}else{if("GET"==this._method){this._uri=this._uri+"&"+this._bodyData}}try{this._frame.src=this._uri}catch(B){return false}},_sendViaForm:function(){form=$(this._bodyData);form.target="frame_"+this._req_id;form.setAttribute("target","frame_"+this._req_id);form.submit()},_onload:function(){try{var B=this._frame.contentDocument.body.innerHTML;this._frame.contentDocument.close()}catch(A){try{var B=this._frame.contentDocument.document.body.innerHTML;this._frame.contentDocument.document.close()}catch(A){try{var B=this._frame.contentWindow.document.body.innerHTML;this._frame.contentWindow.document.close()}catch(A){try{var B=this._frame.document.body.innerHTML;this._frame.document.body.close()}catch(A){try{var B=window.frames["frame_"+this.uniqueId].document.body.innerText}catch(A){}}}}}this.responseText=B;this.status=200;this.setState(4)}});Backend.Ajax.Request=Class.create(Ajax.Request,{initialize:function($super,B,A){this.options={method:"post",transport:"xhr",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}if(this.options.form){this.options.transport="iframe";this.form=$(this.options.form);this.options.method="form";if(null==B){B=this.form.action}}if(/^http/.test(B)){this.options.transport="iframe"}this.transport=Backend.Ajax.getTransport(this.options.transport);this.request(B)},request:function(B){this.url=B;this.method=this.options.method;var D=Object.clone(this.options.parameters);if(!["get","post","form"].include(this.method)){D._method=this.method;this.method="post"}this.parameters=D;if(D=Object.toQueryString(D)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+D}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){D+="&_="}}}try{var A=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(A)}Ajax.Responders.dispatch("onCreate",this,A);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();if(this.method=="form"){this.body=this.form}else{if(this.method=="post"){this.body=this.options.postBody||D}else{this.body=null}}this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(C){this.dispatchException(C)}},});Backend.Ajax._Request=Ajax.Request.prototype;Ajax.Request.prototype.initialize=Backend.Ajax.Request.prototype.initialize;Ajax.Request.prototype.request=Backend.Ajax.Request.prototype.request;Backend.Prototype=Backend.Prototype||{};Backend.Prototype.Form=Backend.Prototype.Form||{};Backend.Prototype.Form.submitThroughIframe=function(A,B){defaultOptions={form:A};Object.extend(defaultOptions,B);return new Ajax.Request(null,defaultOptions)};Element.addMethods("FORM",{submitThroughIframe:Backend.Prototype.Form.submitThroughIframe});Element.addMethods({load:function(C,B,A){C=$(C);A=A||{};A._onComplete=A.onComplete||Prototype.emptyFunction;A.onSuccess=function(E,D){C.update(E.responseText);A._onComplete(E,D)};new Ajax.Request(B,A);return C}});Backend.Prototype={};Backend.Prototype.Element={moveDown:function(A){row=$(A);nextRow=row.next();row.parentNode.insertBefore(nextRow.cloneNode(true),row);nextRow.remove()},moveUp:function(A){row=$(A);prevRow=row.previous();prevRow.parentNode.insertBefore(row.cloneNode(true),prevRow);row.remove()},ifExists:function(A,B){if($el){B()}},evaluate:function(C,B){var D=$(C).innerHtml;var A=new Template(D);return A.evaluate(B)}};Backend.Prototype.Select={formatOptions:function(B,C){C=Object.extend({valueMember:"id",displayMember:"name",before:"",after:""},C);var A=$H(C);var D=A.get("before");if(B&&B.length>0){B.each(function(E){E=$H(E);D+='<option value="'+E.get(A.get("valueMember"))+'">'+E.get(A.get("displayMember"))+"</option>"})}D+=A.get("after");return D},setOptions:function(A,B,C){newOptions=Backend.Prototype.Select.formatOptions(B,C);$select=$(A);$select.update(newOptions)},loadOptions:function(B,E,D){D=D||{};Object.extend(D,typeof E=="string"?{url:E}:E);D=Object.extend({itemsProperty:"items",onComplete:Prototype.emptyFunction},D);var A=D;var C=$(B);C.disabled=true;new Ajax.Request(A.url,{method:"get",transport:"xhr",onComplete:function(G,F){F=F||G.responseJS||G.responseText.evalJSON();if(D.itemsProperty!=""){values=F[A.itemsProperty]}C.setOptions(values,A);if(C.childElements().length==0){C.disabled=true}else{C.disabled=false}A.onComplete()}});return B}};Backend.Prototype.Form={deserializeElements:function(B,C,A){parseName=function(D){var F=D.indexOf("[");var E=new Array();if(F==-1){E.push(D)}else{E.push(D.substring(0,F));D.scan(/\[(\w*)\]/,function(G){E.push(G[1])})}return E};getValue=function(D,G){var E=G[0];var F=undefined;D=$H(D);if(E!=""){F=D.get(E)}else{F=D.get(0)}if(F!=undefined){if(G.length!=1){updates=getValue(F,G.slice(1));D.set(E,updates[1]);return[updates[0],D]}if(E!=""){D.unset(E)}else{D=$A($H(D).values()).slice(1)}return[F,D]}return[undefined,D]};A=$H(A);radiosCache=$H();C.each(function(E){var D=parseName(E.name);function F(H,G){}if((E.tagName=="SELECT")&&(E.multiple==true)){}else{if((E.tagName=="INPUT")&&(E.className.indexOf("checkbox")!=-1)){r=getValue(A,D);value=r[0];A=r[1];if(E.type=="checkbox"){E.value=1}else{$id=E.className.split(" ")[1];E.value=0;ch=$($id);if(ch!=undefined){ch.checked=value==1;ch.value=1}}}}if(E.type=="radio"){if(radiosCache.get(E.name)==undefined){r=getValue(A,D);value=r[0];A=r[1];radiosCache.set(E.name,value)}else{value=radiosCache.get(E.name)}if(E.value==value){E.checked=true}}else{r=getValue(A,D);value=r[0];A=r[1];if(value!=undefined){E.value=value}}E.fire("onChange")})},deserialize:function(B,A){B.deserializeElements(B.getElements(),A)}};Backend.Prototype.Table={formatters:{date:function(A,B,C,E,D){d=Date.parseDate(C,A);return d.print(B)},dateRu:function(A,C,B){return Backend.Prototype.Table.formatters.date("%Y-%m-%d","%d %b %Y",A)}},containers:{email:function(A,B){if(A){return'<a href="mailto: '+A+'">'+A+"</a>"}}},fill:function(B,I,D,A){var C=[];var G=function(J,K){return"<tr>"+J+"</tr>"};var F=function(K,J){return"<td>"+(K?K:"&nbsp;")+"</td>"};var E=function(J,L,K){return J};var A=A||G;D.each(function(J){col={};col.id=J.id;col.cellCallback=J.cellCallback||F;col.containerCallback=J.containerCallback;col.formatter=J.formatter||E;col.formatter=Object.isString(col.formatter)?Backend.Prototype.Table.formatters[J.formatter]:col.formatter;C.push(col)});var H="";$A(I).each(function(K){var J="";C.each(function(L){L.containerCallback===undefined?J+=L.cellCallback(L.formatter(K[L.id],L.id,K),K):J+=L.cellCallback(L.containerCallback(L.formatter(K[L.id],L.id,K),K))});J=A(J,K);H+=J});B.update(H)}};Element.addMethods("FORM",{deserializeElements:Backend.Prototype.Form.deserializeElements,deserialize:Backend.Prototype.Form.deserialize});Element.addMethods("TABLE",{fill:Backend.Prototype.Table.load});Element.addMethods("TBODY",{fill:Backend.Prototype.Table.fill});Element.addMethods("THEAD",{load:Backend.Prototype.Table.load});Element.addMethods("TFOOT",{load:Backend.Prototype.Table.load});Element.addMethods("SELECT",{setOptions:Backend.Prototype.Select.setOptions,loadOptions:Backend.Prototype.Select.loadOptions});Element.addMethods({moveUp:Backend.Prototype.Element.moveUp,moveDown:Backend.Prototype.Element.moveDown});Backend.Component={types:$H(),created:$H(),register:function(A,B){if(Backend.Component.types.isset(B)){throw B+" already registered"}Backend.Component.types.set(B,A)},create:function(C,E,B){var A=this.types.get(C);if(Object.isUndefined(A)){throw"Component class does not registered "+C}if(!Object.isUndefined(this.created.get(E))){throw"Component with id "+E+" is already created"}var D=new A(E,B);this.created.set(E,D);return D},load:function(){Backend.Component.created.values().invoke("render")},$C:function(A){if(Object.isString(A)){return Backend.Component.created.get(A)}else{if(Object.isArray(A)){return Backend.Component.created.findAll(function(B){return A.member(B.key)})}}return undefined}};$C=Backend.Component.$C;$B=function(D,C,E,G){if(Object.isArray(C)){E=C;C={}}if(D[0]=="#"){var B=D.substring(1);D="div";var H=C.id;C=$H(C);C.unset("id");Backend.Component.create(B,H,C.toObject());C={"class":"component",id:H}}var A=$H(C).collect(function(I){return I.key+'="'+I.value+'"'}).join(" ");var F="";if((!Object.isArray(E))&&(!Object.isUndefined(E))){F=E}else{if(Object.isArray(E)){F=E.join("")}}return"<"+D+" "+A+">"+F+"</"+D+">"};Backend.Component.Base=Class.create({initialize:function(B,A){this.setDefaults({cls:""});this.configure(A);this.id=B;this.isRendered=false;this.allOn(A)},toHTML:function(){return $B("div",{id:this.id,"class":this.config.cls})},render:function(A){if(Object.isUndefined(A)){$(this.id).replace(this.toHTML())}else{$(A).replace(this.toHTML())}},hide:function(){if(this.isRendered()){$(this.id).hide()}},show:function(){if(this.isRendered()){$(this.id).show()}},isRendered:function(){return this.isRendered}},Backend.Observable,Backend.Configurable);Backend.Component.Button=Class.create(Backend.Component.Base,{initialize:function($super,B,A){this.setDefaults({label:""});this.addEvents(["click"]);$super(B,A)},toHTML:function(){return $B("input",{type:"button",id:this.id,"class":this.config.cls,value:this.config.label})},render:function($super){$super();$(this.id).observe("click",function(A){this.fire("click",this)}.bind(this))}});Backend.Component.register(Backend.Component.Button,"button");Backend.Component.Field=Class.create(Backend.Component.Base,{initialize:function($super,B,A){this.setDefaults({errorCls:"validation-error"});$super(B,A);if(!Object.isUndefined(this.config.value)){this.setValue(A.value)}},getValue:function(){return $(this.id).value},setValue:function(A){$(this.id).value=A},disable:function(){$(this.id).disable()},enable:function(){$(this.id).enable()},resetValue:function(){$(this.id).value="";this.hideValidator()},validatorHtml:function(){return $B("div",{id:this.id+"-validator","class":this.config.errorCls,style:"display: none;"})},hideValidator:function(){if($(this.id+"-validator")){$(this.id+"-validator").hide()}},showError:function(A){$(this.id+"-validator").update(A);$(this.id+"-validator").show()}});Backend.Component.Field.TextField=Class.create(Backend.Component.Field,{initialize:function($super,B,A){this.setDefaults({multiline:false,rows:"",cols:""});$super(B,A)},toHTML:function(){var A="";if(!this.config.multiline){A+='<input type="text" id="'+this.id+'" class="'+this.config.cls+'"/>'}else{A+='<textarea id="'+this.id+'" cols="'+this.config.cols+'" rows="'+this.config.rows+'"></textarea>'}A+=this.validatorHtml();return A}});Backend.Component.register(Backend.Component.Field.TextField,"textfield");Backend.Component.Field.FlagField=Class.create(Backend.Component.Field,{initialize:function($super,B,A){this.setDefaults({cls:"checks"});this.addEvents(["stateChange"]);$super(B,A)},toHTML:function(){var A="";A+='<input type="checkbox" id="'+this.id+'" class="'+this.config.cls+'"/>';return A},render:function($super){$super();$(this.id).observe("change",function(){this.fire("stateChange",this,$(this.id).checked)}.bind(this))},getValue:function(){return $(this.id).checked},setValue:function(A){$(this.id).checked=(A==true)},resetValue:function(A){this.setValue(false)}});Backend.Component.register(Backend.Component.Field.FlagField,"flagfield");Backend.Component.Field.DataBound=Class.create(Backend.Component.Field,{initialize:function($super,B,A){$super(B,A);if(!Object.isUndefined(this.config.data)){this.setAllRows(this.config.data)}},setAllRows:function(A){this.data=A}});Backend.Component.Field.Radio=Class.create(Backend.Component.Field.DataBound,{initialize:function($super,B,A){this.setDefaults({cls:"bChecks",itemCls:"bRadio",labelCls:"bLabel",data:$A(),valueField:"id",displayField:"label",});this.addEvents(["stateChanged"]);$super(B,A)},toHTML:function(){return $B("span",{id:this.id,"class":this.config.cls},this.validatorHtml())},renderOptions:function(){if(!$(this.id)){return }var B="";var A=0;this.data.each(function(C){var E=C[this.config.valueField];var D=C[this.config.displayField];B+=$B("input",{type:"radio",id:this.id+A,name:this.id,"class":this.config.itemCls,value:E},[$B("label",{"for":this.id+A,"class":this.config.labelCls},D)]);A++}.bind(this));$(this.id).update(B);this.hookOptionsEvents()},render:function($super){$super();this.renderOptions()},hookOptionsEvents:function($super){var A=0;this.data.each(function(B){$(this.id+A).observe("change",function(C){this.fire("stateChanged",this.getValue())}.bind(this));A++}.bind(this))},setAllRows:function($super,A){$super(A);this.renderOptions()},getValue:function(){var A=$(this.id).childElements().find(function(B){return B.checked});return A?A.value:null},setValue:function(A){$(this.id).childElements().each(function(B){if(B.value==A){B.checked=true}})},resetValue:function(A){$(this.id).childElements().each(function(B){B.checked=false});this.hideValidator()}});Backend.Component.register(Backend.Component.Field.Radio,"radiofield");Backend.Component.Field.Select=Class.create(Backend.Component.Field.DataBound,{initialize:function($super,B,A){this.setDefaults({size:1,valueField:"id",displayField:"label"});this.addEvents(["change"]);$super(B,A)},toHTML:function(){var A=this.config.size>1?'size="'+this.config.size+'"':"";return'<select class="'+this.config.cls+'" id="'+this.id+'" '+A+"></select>"+this.validatorHtml()},renderOptions:function(){$(this.id).update("");if(!Object.isArray(this.data)){return }var A=this.getValue();var B="";this.data.each(function(C){B+='<option value="'+C[this.config.valueField]+'">'+C[this.config.displayField]+"</option>"}.bind(this));$(this.id).update(B);this.setValue(A)},render:function($super){$super();this.renderOptions();$(this.id).observe("change",function(A){this.fire("change",this,this.getValue())}.bind(this))},setAllRows:function($super,A){$super(A);this.renderOptions()}});Backend.Component.register(Backend.Component.Field.Select,"selectfield");Backend.Component.Field.MultiSelect=Class.create(Backend.Component.Field.Select,{initialize:function($super,B,A){this.setDefaults({size:10,valueKey:"id"});$super(B,A)},toHTML:function(){return'<select class="'+this.config.cls+'" id="'+this.id+'" multiple="yes" size="'+this.config.size+'"></select>'+this.validatorHtml()},getValue:function(){var A=[];$A($(this.id).options).each(function(B){if(B.selected){A.push(B.value)}});return A},setValue:function(A){this.resetValue();if(this.config.valueKey!=""){A=A.pluck(this.config.valueKey)}$A($(this.id).options).each(function(B){if(A.member(B.value)){B.selected=true}})},resetValue:function(){$A($(this.id).options).each(function(A){A.selected=false});this.hideValidator()}});Backend.Component.register(Backend.Component.Field.MultiSelect,"multiselectfield");Backend.Component.Switcher=Class.create(Backend.Component.Field.DataBound,{initialize:function($super,B,A){this.setDefaults({template:{inactive:new Template('<li id="#{id}"><a href="#">#{name}</a></li>'),active:new Template('<li id="#{id}" class="chosen">#{name}</a></li>'),activator:new Template('<a class="dashed" id="#{id}-activator" href="#">#{name}</a>')},selected:0});this.addEvents(["change"]);$super(B,A);this.selected=this.config.selected},render:function($super){this.renderVariants();this.updateActivator()},updateActivator:function(){if($(this.id+"-activator")){var A=this.data[this.selected]||{};A=Object.clone(A);A.id=this.id;$(this.id+"-activator").replace(this.config.template.activator.evaluate(A));$(this.id+"-activator").observe("click",function(B){$(this.id+"-container").show();return false}.bind(this))}},renderVariants:function(){if(!Object.isArray(this.data)){return }var A="";var B=0;this.data.each(function(C){var D=this.id+"-variant-"+B;if(this.selected==B){A+=this.config.template.active.evaluate(Object.extend(Object.clone(C),{id:D}))}else{A+=this.config.template.inactive.evaluate(Object.extend(Object.clone(C),{id:D}))}B++}.bind(this));$(this.id).update(A);B=0;this.data.each(function(C){$(this.id+"-variant-"+B).observe("click",function(D){this.scope.setValue.bind(this.scope)(this.n);if($(this.scope.id+"-container")){$(this.scope.id+"-container").hide()}}.bind({scope:this,n:B++}))}.bind(this))},setValue:function(A){this.selected=A;this.fire("change",this,A);this.renderVariants();this.updateActivator()},getValue:function(){return this.data[this.selected]},resetValue:function(){this.setValue(null)},setAllRows:function($super,A){$super(A);this.renderVariants()}});Backend.Component.register(Backend.Component.Switcher,"switcher");Backend.Component.Switcher.Page=Class.create(Backend.Component.Switcher,{initialize:function($super,B,A){this.setDefaults({template:{active:new Template('<span class="chosen" id="#{id}">#{pageNo}</span>'),inactive:new Template('<span id="#{id}"><a href="#">#{pageNo}</a></span>')}});$super(B,A)},setAllRows:function($super,A){A=A.map(function(B){return{pageNo:B}});$super(A)}});Backend.Component.register(Backend.Component.Switcher.Page,"pageSwitcher");Backend.Component.Grid=Class.create(Backend.Component.Field.DataBound,{initialize:function($super,B,A){this.setDefaults({cls:"bGrid",thCls:"bTh",header:null,recordMap:null});this.addEvents(["dispatchAction",]);$super(B,A);this._prepareRecordMap();this.on("dispatchAction",this.dispatchAction.bind(this))},dispatchAction:function(B,A,C){this.fire(B+"Action",this,A,C)},toHTML:function(){return $B("table",{"class":this.config.cls,id:this.id},[$B("thead",{id:this.id+"-head"}),$B("tbody",{id:this.id+"-body"}),$B("tfoot",{id:this.id+"-foot"})])},render:function($super){$super();this.renderHeader();this.renderBody();this.renderFooter()},renderHeader:function(){if(!this.config.header){return }var C=0;var A=this.config.header.map(function(D){D=Object.extend({width:"%",title:"",cls:this.config.thCls},D);return $B("th",{width:D.width,"class":D.cls,id:this.id+"-header-"+(C++)},D.title)}.bind(this));var B=$B("tr",{},A);$(this.id+"-head").update(B)},renderBody:function(){},renderFooter:function(){},insertRow:function(A,B){this.insertRows($A(A),B)},insertRows:function(C,D){D=D||$(this.id+"-body").childElements().length-1;D<0?D=0:D=D;D>c.length?D=c.length-1:D=D;yCur=D;var A=C.inject("",function(E,F){return E+this._getRow(F,yCur++)}.bind(this));var B=this.getRowElement(D);if(Object.isUndefined(B)){$(this.id+"-body").update(A)}else{B.insert({before:A})}},addRows:function(C){var E=$(this.id+"-body").childElements().length-1;E=E<0?0:E;var B=E;var A=C.inject("",function(F,G){return F+this._getRow(G,B++)}.bind(this));var D=this.getRowElement(E);if(Object.isUndefined(D)){$(this.id+"-body").update(A)}else{D.insert({after:A})}},addRow:function(A){this.addRows([A])},replaceRow:function(C,D){var B=this._getRow(C,D);var A=getRowElement(D);if(!Object.isUndefined(A)){A.replace(B)}},removeRow:function(A){this.removeRows([A])},removeRows:function(A){A=A.sort().reverse();A.each(function(B){this.getRowElement(B).remove()}.bind(this))},setAllRows:function(A){this.removeAllRows();this.addRows(A)},removeAllRows:function(){$(this.id+"-body").childElements().invoke("remove")},getRowElement:function(B){var A=$(this.id+"-body").childElements();B<0?B=0:B=B;B>A.length?B=A.length-1:B=B;return A[B]},_prepareRecordMap:function(){this.recordMap=this.config.recordMap.map(function(B){var A=B;if(!Object.isFunction(B.formatter)&&(!Object.isUndefined(B.formatter))){A.formatter=Backend.Component.Grid.Formatters[B.formatter.type].curry(B.formatter)}if(B.action){this.addEvent(B.action+"Action")}return A}.bind(this))},_getRow:function(D,E){x=0;var B=this.recordMap.map(function(I){var G=I.constantValue;if(!Object.isUndefined(I.field)){G=D[I.field]}if(Object.isFunction(I.getter)){G=I.getter(D)}if(Object.isFunction(I.formatter)){G=I.formatter(D,G,x,E)}if(I.action){var H="$C('"+this.id+"').fire('dispatchAction', '"+I.action+"', "+x+", "+E+"); return false;";G=$B("a",{href:"#",onClick:H},G)}if(I.boolValues){G?G=I.boolValues[0]:G=I.boolValues[1]}if(G==""){G=I.spaceReplacement}G=G||I.nullReplacement;x++;var F=this.id+"-cell-column-"+x+" "+this.id+"-cell-row-"+E;return $B("td",{id:this.id+"-cell-"+x+"-"+E,"class":F},G)}.bind(this));var C=E%2==0?"even":"odd";var A=this.id+"-"+C+" bGrid-"+C;return $B("tr",{id:this.id+"-row-"+E,"class":A},B.join("")+"</tr>")}});Backend.Component.Grid.Formatters={dictionary:function(B,D,C,A,E){C=$A(B.values).get(C,B.key);if(!Object.isUndefined(C)){C=C[B.value]}return C}};Backend.Component.register(Backend.Component.Grid,"grid");Backend.Behavior=Class.create({initialize:function(B,A){this.attached=B;this.configure(A);$H(this.attached).each(function(C){if(C.value){this.attach(C.key,C.value)}}.bind(this));this.allOn(A)},attach:function(B,A){}},Backend.Observable,Backend.Configurable);Backend.Behavior.List=Class.create(Backend.Behavior,{initialize:function($super,B,A){this.setDefaults({paginate:[null,null],getList:Prototype.emptyFunction});$super(B,A);if(this.config.source){this.config.getList=this.config.source.getList.bind(this.config.source);this.config.source.on("changed",this.load.bind(this));this.config.source.on("save",this.load.bind(this));this.config.source.on("remove",this.load.bind(this))}this.page=1;this.filter={}},attach:function($super,A,B){if(A=="pageSwitch"){B.on("change",function(C,D){this.page=D;this.load()}.bind(this))}},applyFilter:function(A){this.filter=A},resetFilter:function(){this.filter={}},load:function(){this.config.getList({page:this.page,paginate:this.config.paginate,filter:this.filter},this.onLoad.bind(this))},onLoad:function(A){this.attached.list.setAllRows(A.records);if(!Object.isUndefined(this.attached.total)){$(this.attached.total).update(A.total)}if(this.attached.pageSwith){this.attached.pageSwith.setAllRows(this.page)}}});Backend.Behavior.Editor=Class.create(Backend.Behavior,{initialize:function($super,B,A){this.setDefaults({getItem:Prototype.emptyFunction,saveItem:Prototype.emptyFunction,removeItem:Prototype.emptyFunction,key:null});$super(B,A);if(this.config.source){this.config.saveItem=this.config.source.saveItem.bind(this.config.source);this.config.getItem=this.config.source.getItem.bind(this.config.source);this.config.removeItem=this.config.source.removeItem.bind(this.config.source)}},attach:function($super,B,A){switch(B){case"list":A.on("editAction",function(D,C,E){if(this.config.key){this.edit(this.config.source.data[E][this.config.key])}else{this.edit(E)}}.bind(this));A.on("removeAction",function(D,C,E){if(this.config.key){this.remove(this.config.source.data[E]["id"])}else{this.remove(E)}}.bind(this));break;case"saveButton":A.on("click",this.save.bind(this));break;case"cancelButton":A.invoke("on","click",this.cancel.bind(this));break}},edit:function(A){if(this.attached.container){$(this.attached.container).show()}this.attached.form.values().invoke("resetValue");this.keyValue=A;this.config.getItem(A,this.onEdit.bind(this))},add:function(){if(this.attached.container){$(this.attached.container).show()}this.attached.form.values().invoke("resetValue");this.onEdit({})},save:function(){var A={};this.attached.form.each(function(B){A[B.key]=B.value.getValue()});this.config.saveItem(this.keyValue,A,this.onSaveSuccess.bind(this),this.onSaveFailure.bind(this))},remove:function(A){this.config.removeItem(A,this.onRemoveSuccess.bind(this))},onEdit:function(A){this.attached.form.each(function(B){if(!Object.isUndefined(A[B.key])){B.value.setValue(A[B.key])}})},onSaveSuccess:function(A){if(this.attached.container){$(this.attached.container).hide()}this.attached.form.values().invoke("resetValue");if(this.attached.container){$(this.attached.container).hide()}this.keyValue=undefined},onSaveFailure:function(A){$H(A).each(function(C){var B=this.attached.form.get(C.key);B.showError(C.value)}.bind(this))},onRemoveSuccess:function(){},cancel:function(){if(this.attached.container){$(this.attached.container).hide()}this.attached.form.values().invoke("resetValue")}});Backend.Behavior.LinkedLists=Class.create(Backend.Behavior,{initialize:function($super,B,A){this.addEvents(["change"]);$super(B,A)},attach:function($super,C,B){switch(C){case"selects":var A=0;B.each(function(D){if(A>0){D.select.disable()}else{Backend.DataSource.Read(D.select,D.url)}D.select.on("change",function(G,E,H){var F={};F[G.filter]=H;Backend.DataSource.Read(G.select,G.url,{filter:F});G.select.enable()}.bind(this).curry(B[A+1]));A++}.bind(this));break}}});if(Backend.Prototype==undefined){throw ("Backend.Data requires including backend's prototype.js library")}Backend.DataSource={};Backend.DataSource.Read=function(C,B,A){A=A||{};new Ajax.Request(B,{method:"post",postBody:Object.toJSON(A),onComplete:function(E,D){D=D||E.responseJS||E.responseText.evalJSON();this.setAllRows(D.records)}.bind(C)})};Backend.DataSource.List=Class.create({initialize:function(A){this.configure(A);this.load(A.data);this.addEvents(["changed","save","remove"])},getList:function(A,B){B({records:this.data,total:this.data.length})},getItem:function(A,B){B(this.data[A])},saveItem:function(B,C,D,A){if(!Object.isUndefined(B)){this.data[B]=C}else{this.data.push(C)}D();this.fire("save",this)},removeItem:function(A,B){delete this.data[A];this.data=this.data.compact();B();this.fire("remove",this)},removeItems:function(A,B){this.suspend();A.each(function(C){this.removeItem(C)}.bind(this));this.resume();this.fire("remove",this)},load:function(A){this.data=A||$A();this.fire("changed")}},Backend.Configurable,Backend.Observable);Backend.DataSource.List.ValuableDecorator=Class.create(Backend.DataSource.List,{getValue:function(){return this.data},setValue:function(A){this.load(A)},resetValue:function(A){this.setValue($A())}});Backend.DataSource.List.Remote=Class.create(Backend.DataSource.List,{initialize:function($super,A){this.setDefaults({listUrl:"",saveUrl:"",getUrl:""});$super(A);this.addEvents(["requestFailure","requestException"]);this.fireFailure=function(B){this.fire("requestFailure",B)}.bind(this);this.fireException=function(B,C){this.fire("requestException",C)}.bind(this);this.complete=function(C,B){try{B=B||C.responseJS||C.responseText.evalJSON()}catch(D){this.fireException(D)}return B}.bind(this);this.data=$A()},getList:function($super,A,B){A=Object.extend({page:0,pageSize:0,sliceLength:0,filter:{}},A);new Ajax.Request(this.config.listUrl,{method:"post",postBody:Object.toJSON({page:A.page,pageSize:A.paginate[0],sliceLength:A.paginate[1],filter:A.filter}),onComplete:this.complete.wrap(function(E,D,C){C=E(D,C);this.data=C.records;B(C)}.bind(this)),onFailure:this.fireFailure,onException:this.fireException})},getItem:function($super,A,B){new Ajax.Request(this.config.getUrl,{method:"post",postBody:Object.toJSON({id:A}),onComplete:this.complete.wrap(function(E,D,C){C=E(D,C);B(C)}),onFailure:this.fireFailure,onException:this.fireException})},saveItem:function(A,D,C,B){new Ajax.Request(this.config.saveUrl,{method:"post",postBody:Object.toJSON({id:A,values:D}),onComplete:this.complete.wrap(function(G,F,E){E=G(F,E);if(E.result==true){C(E.id);this.fire("save",this)}else{B(E.errors)}}.bind(this)),onFailure:this.fireFailure,onException:this.fireException})},removeItem:function(A,C,B){new Ajax.Request(this.config.removeUrl,{method:"post",postBody:Object.toJSON({id:A}),onComplete:this.complete.wrap(function(F,E,D){D=F(E,D);if(D.result==true){C();this.fire("remove",this)}else{B()}}.bind(this)),onFailure:this.fireFailure,onException:this.fireException})}});