$ns=function(ns){ns=ns.split(".");var name=ns.shift();var cmd="";for(n=0;n<ns.length+1;n++){cmd+="if (Object.isUndefined(window."+name+")) window."+name+"={};";name=name+"."+ns[n]}eval(cmd)};$ns("Backend.Prototype");$rq=function(){$A(arguments).each(function(ns){if(eval("Object.isUndefined(window."+ns+");")){throw new Error(ns+" is required")}})};Backend.Prototype.build=function(C,B,D,F){C=C.toLowerCase();if(Object.isArray(B)){F=D,D=B,B=undefined}if(Object.isString(B)){F=B,D=$A(),B=$H()}if(Object.isString(D)){F=D,D=$A()}D=Object.isArray(D)?D:$A(),B=B||$H(),F=F||"";var E=$H(B).collect(function(G){return G.key+'="'+G.value+'"'}).join(" ");var A="<"+C;A+=E==""?"":" "+E;A+=">"+F+D.join("")+"</"+C+">";return A};$B=Backend.Prototype.build;Backend.Prototype.Element={moveDown:function(B,A){A=A||1;var D=$(B);if(!Object.isUndefined(D)){var C=D.next();if(C!=null){D.parentNode.insertBefore(C.cloneNode(true),D);C.remove()}}},moveUp:function(B,A){A=A||1;var C=$(B);if(!Object.isUndefined(C)){var D=C.previous();if(D!=null){D.parentNode.insertBefore(C.cloneNode(true),D);C.remove()}}},when:function(A,B,C){if($(A)){return B($(A))||true}else{return typeof C=="function"?C():false}},evaluate:function(C,B){var D=$(C).innerHTML;if(C.tagName.toLowerCase()=="textarea"){D=D.unescapeHTML()}var A=new Template(D);return A.evaluate(B)}};Backend.Prototype.Element.Events={_observe:function(){var B=$A(arguments);var A=B.shift(),E=B.shift(),D=B.shift(),C=B.shift();D=D.bindAsEventListener(C,B);E.observe(A,D)},click:function(){var A=$A(arguments);fn=Backend.Prototype.Element.Events._observe.apply(this,["click"].concat(A))}};Backend.Prototype.Form={deserializeElements:function(form,elements,values){if(Object.isHash(values)){values=values.toObject()}var cached=$H();elements.each(function(el){var name=el.name||el.id;if(Object.isUndefined(name)){return }if(!cached.keys().member(name)){var bracketPos=name.indexOf("[");name=bracketPos==-1?"["+name+"]":"["+name.substring(0,bracketPos)+"]"+name.substring(bracketPos);name=name.replace("[]",".shift()");name=name.replace(/\[([\w\d]+)\]/g,'["$1"]');try{value=eval("values"+name)}catch(e){return }}else{value=cached.get(name)}if(Object.isUndefined(value)){return }if(el.tagName.toUpperCase()=="INPUT"){if(el.type.toUpperCase()=="RADIO"){if(el.value==value){el.checked=true}else{cached.set(el.name,value)}}else{el.setValue(value)}}else{el.setValue(value)}},this)},deserialize:function(B,A){B.deserializeElements(B.getElements(),A)}};Backend.Prototype.Select={formatOptions:function(A,B){B=Object.extend({valueMember:"id",displayMember:"name"},B);if(!Object.isArray(B.before)){B.before=$A()}if(!Object.isArray(B.after)){B.after=$A()}A=B.before.concat(A,B.after);var C="";if(A&&A.length>0){A.each(function(D){var E=D[B.valueMember]||"";var F=D[B.displayMember]||"";C+='<option value="'+E+'">'+F+"</option>"})}return C},setOptions:function(A,B,C){var D=Backend.Prototype.Select.formatOptions(B,C);$select=$(A);$select.update(D)}};Element.addMethods("FORM",{deserializeElements:Backend.Prototype.Form.deserializeElements,deserialize:Backend.Prototype.Form.deserialize});Element.addMethods("SELECT",{setOptions:Backend.Prototype.Select.setOptions});Element.addMethods({moveUp:Backend.Prototype.Element.moveUp,moveDown:Backend.Prototype.Element.moveDown,when:Backend.Prototype.Element.when,evaluate:Backend.Prototype.Element.evaluate,click:Backend.Prototype.Element.Events.click});Element.addMethods("INPUT",{click:Backend.Prototype.Element.Events.click});$ns("Backend.Observable");Backend.Observable={addEvent:function(A){this.addEvents([A])},addEvents:function(A){this.listeners=this.listeners||{};A.each(function(B){if(this.listeners[B]==undefined){this.listeners[B]=[]}}.bind(this))},on:function(A,B){this.listeners=this.listeners||{};if(this.listeners[A]==undefined){return }this.listeners[A].push(B)},allOn:function(A){if(Object.isUndefined(A)){return }$H(this.listeners).keys().each(function(B){if(!Object.isUndefined(A[B])){this.on(B,A[B])}})},fire:function(){args=$A(arguments);name=args.shift();this.listeners=this.listeners||{};if(this.listeners[name]!=undefined){this.listeners[name].each(function(A){A.apply(A,args)})}},purge:function(){this.listeners={}},removeEvent:function(A,B){if(this.listeners[A]==undefined){return }this.listeners[A]=this.listeners[A].without(B)},suspend:function(){this.suspendEvents=true},resume:function(){this.suspendEvents=false}};$ns("Backend.Configurable");Backend.Configurable={setDefaults:function(A){this.defaults=this.defaults||{};this.defaults=Object.extend(A,this.defaults)},configure:function(A){this.defaults=this.defaults||{};this.config=Object.extend(this.defaults,A)},getConfig:function(){return this.config}};$ns("Backend.Ajax");Backend.Ajax={iframeRequests:{},cache:$H(),reqCount:0,getXmlHttpRequest:Ajax.getTransport,getTransport:function(A){A=A||"xhr";if("xhr"==A.toLowerCase()){return Backend.Ajax.getXmlHttpRequest()}else{if("iframe"==A.toLowerCase()){return new Backend.Ajax.IframeRequest()}}},createIframe:function(D){var A=this;var B=document.createElement("DIV");Object.extend(B.style,{position:"absolute",top:0,marginLeft:"-10000px"});if(navigator.userAgent.indexOf("MSIE")>0&&navigator.userAgent.indexOf("Opera")==-1){B.innerHTML='<iframe name="frame_'+D+'" id="frame_'+D+'" src="about:blank" onload="setTimeout(function(){Backend.Ajax.iframeRequests['+D+']._onload()},20);"></iframe>'}else{var C=document.createElement("iframe");C.setAttribute("name","frame_"+D);C.setAttribute("id","frame_"+D);C.addEventListener("load",function(){Backend.Ajax.iframeRequests[D]._onload()},false);B.appendChild(C)}document.getElementsByTagName("body").item(0).appendChild(B);var C=$("frame_"+D);C.observe("load",function(){Backend.Ajax.iframeRequests[D]._onload()});return C}};Ajax.getTransport=Backend.Ajax.getTransport;Backend.Ajax.IframeRequest=Class.create({initialize:function(){this.responseText=null;this.responseXML=null;this.status=null;this.statusText=null;this.readyState=0;Backend.Ajax.reqCount++;this._method=null;this._uri=null;this._bodyData=null;this._req_id=Backend.Ajax.reqCount;this._requestHeaders={};Backend.Ajax.iframeRequests[this._req_id]=this},onreadystatechange:function(){},setState:function(A){this.readyState=A;this.onreadystatechange()},open:function(E,C,B,D,A){this._method=E.toUpperCase();this._uri=C;this.setState(1)},setRequestHeader:function(B,A){this._requestHeaders[B]=A},send:function(A){this._bodyData=A;this._frame=Backend.Ajax.createIframe(this._req_id);if("FORM"==this._method){return this._sendViaForm()}else{if("GET"==this._method){this._uri=this._uri+"&"+this._bodyData}}try{this._frame.src=this._uri}catch(B){return false}},_sendViaForm:function(){form=$(this._bodyData);form.target="frame_"+this._req_id;form.setAttribute("target","frame_"+this._req_id);form.action=this._uri;form.submit()},_onload:function(){try{var B=this._frame.contentDocument.body.innerHTML;this._frame.contentDocument.close()}catch(A){try{var B=this._frame.contentDocument.document.body.innerHTML;this._frame.contentDocument.document.close()}catch(A){try{var B=this._frame.contentWindow.document.body.innerHTML;this._frame.contentWindow.document.close()}catch(A){try{var B=this._frame.document.body.innerHTML;this._frame.document.body.close()}catch(A){try{var B=window.frames["frame_"+this.uniqueId].document.body.innerText}catch(A){}}}}}this.responseText=B;this.status=200;this.setState(4)}});Backend.Ajax.Request=Class.create(Ajax.Request,{initialize:function($super,B,A){this.options={method:"post",transport:"xhr",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true,cache:false};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters)){this.options.parameters=this.options.parameters.toQueryParams()}if(this.options.form){this.options.transport="iframe";this.form=$(this.options.form);this.options.method="form";if(null==B){B=this.form.action}}if(/^http/.test(B)){this.options.transport="iframe"}this.transport=Backend.Ajax.getTransport(this.options.transport);this.request(B)},request:function(B){this.url=B;this.method=this.options.method;var D=Object.clone(this.options.parameters);if(!["get","post","form"].include(this.method)){D._method=this.method;this.method="post"}this.parameters=D;if(D=Object.toQueryString(D)){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+D}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){D+="&_="}}}try{var A=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(A)}Ajax.Responders.dispatch("onCreate",this,A);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();if(this.method=="form"){this.body=this.form}else{if(this.method=="post"){this.body=this.options.postBody||D}else{this.body=null}}if(!this.options.cache){this.transport.send(this.body)}else{if(this._isCached(this)){this.transport=this._getCached(this);this.onStateChange()}else{this.transport.send(this.body)}}if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(C){this.dispatchException(C)}},_getCacheKey:function(A){return A.url+Object.toJSON(A.parameters)},_cache:function(A){var B=this._getCacheKey(A.request);Backend.Ajax.cache.set(B,A)},_isCached:function(A){var B=this._getCacheKey(A);return Backend.Ajax.cache.keys().member(B)},_getCached:function(A){var B=this._getCacheKey(A);return Backend.Ajax.cache.get(B)},respondToReadyState:function($super,A){$super(A);if(this.options.cache){var C=Ajax.Request.Events[A],B=new Ajax.Response(this);if(C=="Complete"){this._cache(B)}}}});$AJAX=function(B,A){return new Backend.Ajax.Request(B,A)};Backend.Prototype=Backend.Prototype||{};Backend.Prototype.Form=Backend.Prototype.Form||{};Backend.Prototype.Form.submitThroughIframe=function(A,B){defaultOptions={form:A};Object.extend(defaultOptions,B);return new Ajax.Request(null,defaultOptions)};Element.addMethods("FORM",{submitThroughIframe:Backend.Prototype.Form.submitThroughIframe});Element.addMethods({load:function(C,B,A){C=$(C);A=A||{};A._onComplete=A.onComplete||Prototype.emptyFunction;A.onSuccess=function(E,D){C.update(E.responseText);A._onComplete(E,D)};new Ajax.Request(B,A);return C}});$ns("Backend.Behavior");$rq("Backend.Prototype","Backend.Observable","Backend.Configurable");Backend.Behavior=Class.create({initialize:function(){this.debug=false;if(Prototype.Browser.WebKit){this.timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(this.timer);delete this.timer;this.load()}}.bind(this),10)}else{if(Prototype.Browser.IE){Event.observe(window,"load",this._onLoad.bindAsEventListener(this))}else{Event.observe(document,"DOMContentLoaded",this._onLoad.bindAsEventListener(this))}}},_onLoad:function(A){if(Prototype.Browser.IE){this.load.bind(this).delay(0.3)}else{this.load.bind(this)()}},load:function(){}});Backend.Behavior.Cloneable=Class.create({initialize:function(A){this.setDefaults({container:null,defaultTemplate:null});this.addEvents(["create","remove"]);this.configure(A);this.container=this.config.container;this.rowById=$H()},count:function(){return $(this.container).childElements().length},clear:function(){$(this.container).update("")},getRow:function(A){return this.rowById.get(A)},_getTemplate:function(A){return Object.isString(A)?A:this.config.defaultTemplate},add:function(B,C){var A=this._getTemplate(C);B=B||{};id=B.__id=this.count();A=$(A).evaluate(B);$(this.container).insert(A);var D=$(this.container).childElements().last();this.rowById.set(id,D);D.__tag=B;D.__id=id;this.fire("create",this,id,D,D.__tag);return id},addN:function(C,B,A){C.times(this.add.bind(this,A,B))},addAll:function(A,B){A=A||$A();A.each(function C(D){this.add(D,B)},this)},insert:function(C,A,B){throw new Error("insert() not implemented")},insertAllN:function(C,A,B){throw new Error("insertAllN() not implemented")},insertAll:function(C,A,B){throw new Error("insertAll() not implemented")},remove:function(C){if(Object.isUndefined(C)){var A=$(this.container).childElements().last();C=A?A.__id:null}if(C!=null){var B=this.getRow(C);if(B){this.fire("remove",this,C,B,B.__tag);B.remove()}}},removeN:function(A){A.times(function(){this.remove()}.bind(this),this)},removeAll:function(A){A.each(this.remove,this)}},Backend.Configurable,Backend.Observable);